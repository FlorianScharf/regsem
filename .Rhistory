Data[[i]] <- data.frame(X=X, Y=Y, M1=M1, M2=M2, M3=M3, M4=M4, M5=M5)
fit.delta[[i]] = sem(model,data=Data[[i]],meanstructure=FALSE,fixed.x=T)
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="numDeriv")
fit.cv.delta[[1]]
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="ram",hessFun="none")
fit.cv.delta[[1]]
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="ram",hessFun="none")
plot(fit.cv.delta[[1]])
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="none")
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="numDeriv")
plot.new()
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="none")
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="numDeriv)
fit.cv.delta[[1]]
plot(fit.cv.delta[[1]])
bics.delta = fit.cv.delta[[i]][,"chisq"]
mmin.delta = min(bics.delta[bics.delta > 0])
lam.delta = fit.cv.delta[[i]][which(bics.delta == mmin.delta),"lambda"]
fit.reg[[i]] = multi_optim(fit.delta[[i]],lambda=lam.delta,type="lasso",gradFun="ram",pars_pen = c(2:11),max.try=50,tol=1e-6,verbose=F)
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="numDeriv")
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="ram",hessFun="none")
windows()
plot(fit.cv.delta[[1]])
windows()
plot(fit.cv.delta[[1]])
library(regsem)
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="ram",hessFun="none")
plot(fit.cv.delta[[1]])
library(regsem)
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="ram",hessFun="numDeriv")
plot(fit.cv.delta[[1]])
fit.cv.delta[[1]]
mod <- '
f =~ 1*x1 + 1*x2 + 1*x3 + 0.2*x4 + 0.2*x5 + 0*x6 + 0*x7 +0*x8 + 0*x9
'
dat <- simulateData(mod,model.type="cfa")
mod2 <- 'f =~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9'
outt = cfa(mod2,dat,meanstructure=FALSE)
lavaan(parTable(outt),hs.train)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),
pars_pen=c(3:8),solver=TRUE,fit.ret2="cv",mult.start=TRUE)
fit1
summary(out)
summary(outt)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),
pars_pen=c(3:8),solver=FALSE,fit.ret2="cv",mult.start=TRUE)
fit1
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv")
fit1
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv")
fit1
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none")
plot.new()
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
windows()
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv")
fit1
windows()
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
windows()
plot(fit1)
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
plot(fit1)
?cv_regsem
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none")
windows()
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv")
windows()
plot(fit1)
?optim
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
windows()
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.001,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
windows()
plot(fit1)
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.001,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
windows()
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.1,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
windows()
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.1,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
windows()
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.1,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none",alpha=1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.1,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none",alpha=.8)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.1,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none",alpha=.3)
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.1,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none",alpha=.3)
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.1,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none",alpha=.3)
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none",alpha=.3)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-4,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none",alpha=.1)
fit1
plot(fit1)
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-4,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none",alpha=.1)
fit1
windows()
plot(fit1)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-4,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none",alpha=.1)
fit1
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="ram",hessFun="none")
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="none")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="norm")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="numDeriv")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
library(regsem)
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="ram",hessFun="none")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="none")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="numDeriv",hessFun="none")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="numDeriv",hessFun="none")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="numDeriv",hessFun="numDeriv")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="numDeriv",hessFun="numDeriv")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
library(regsem)
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="numDeriv",hessFun="numDeriv")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="ram",hessFun="numDeriv")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
library(regsem)
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="ram",hessFun="numDeriv")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="numDeriv")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="numDeriv",hessFun="numDeriv")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="numDeriv",hessFun="numDeriv")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="numDeriv",hessFun="numDeriv")
fit.cv.delta[[1]]
windows()
plot(fit.cv.delta[[1]])
library(regsem)
setwd("C:/Users/RJacobucci/Documents/GitHub/mimic_regsem")
setwd("C:/Users/Ross/Documents/GitHub/mimic_regsem")
library(lavaan)
library(qgraph)
library(semPlot)
library(psych)
library(regsem)
library(lmtest)
library(ggplot2)
library(reshape2)
library(semTools)
#Here one reads in the data - As I can't share it yet I created a dummy dataset with same means and covs.
#Parameter estimates are identical down to the third decimal so for now we can just use the dummy data (for final paper just rerun with the 'real' - only difference would be skewness and nonlinearities but those are negligible)
#datacamcan<-read.csv('CamCAN_cogneuro_data_Ross2017-03-16.csv')  #Reads in real data
datacamcan<-read.csv('schmamcandat2017-03-16.csv')
colnames(datacamcan)[3:50]<-print(paste('gm',1:48,sep=''))        #Unify grey matter labels for easier syntax
colnames(datacamcan)[51:98]<-print(paste('fa',1:48,sep=''))       #Unify grey matter labels for easier syntax
datacamcan$simpred1<-datacamcan$VSTMcolour_K_ss3+rnorm(708,.5,.5) #add dummy predictors for reference
datacamcan$simpred2<-datacamcan$VSTMcolour_K_ss3+rnorm(708,.5,.5) #add dummy predictors for reference
#Below the syntax to fit normal ML and regsem MIMIC models to predict a single LV (vstmlv) measured by three observables
#Syntax below is to use white matter (fa) and grey matter (gm) to predict a single LV.
#Total R^2 for FA predicting vstmlv is ~38% (versus 8% with noise), and ~27% for gm
#Most exciting would be to include both of course
#############Predicting VSTM: White matter (48 ROIS)
vstmCFA_WM<-'
vstmlv=~VSTMcolour_K_ss2+VSTMcolour_K_ss3+VSTMcolour_K_ss4
vstmlv~fa 1 +fa 2 +fa 3 +fa 4 +fa 5 +fa 6 +fa 7 +fa 8 +fa 9 +fa 10 +fa 11 +fa 12 +fa 13 +fa 14 +fa 15 +fa 16 +fa 17 +fa 18 +fa 19 +fa 20 +fa 21 +fa 22 +fa 23 +fa 24 +fa 25 +fa 26 +fa 27 +fa 28 +fa 29 +fa 30 +fa 31 +fa 32 +fa 33 +fa 34 +fa 35 +fa 36 +fa 37 +fa 38 +fa 39 +fa 40 +fa 41 +fa 42 +fa 43 +fa 44 +fa 45 +fa 46 +fa 47 +fa 48
'
fitvstm_WM <- cfa(vstmCFA_WM, data=datacamcan, estimator='mlr',missing='fiml')
summary(fitvstm_WM, fit.measures=TRUE, standardized=TRUE, rsquare=TRUE)
#regsem
lav.out_WM<-try(lavaan::sem(vstmCFA_WM,datacamcan,fixed.x=TRUE,meanstructure=FALSE),silent=TRUE)
A <- extractMatrices(lav.out_WM)$A
A[A!=0]
#cov.test= cov(data.test[,c(51:98,100:102)],use="complete.obs")
#tt = regsem(lav.out_WM)
#reg.out1_WM <- cv_regsem(lav.out_WM,n.lambda=40,jump=0.005,solver=TRUE,tol=1e-4,type="enet",pars_pen=c(3:50),
#                         fit.ret=c("rmsea","BIC","srmr","EBIC.25","EBIC.5","AIC","CAIC"))
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.03,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE)
plot(reg.out2_WM,c(3:50))
reg.out2_WM
library(regsem)
mod <- '
f =~ 1*x1 + 1*x2 + 1*x3 + 0.2*x4 + 0.2*x5 + 0*x6 + 0*x7 +0*x8 + 0*x9
'
dat <- simulateData(mod,model.type="cfa")
mod2 <- 'f =~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9'
outt = cfa(mod2,dat,meanstructure=FALSE)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-4,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv",alpha=1,max.iter=200)
fit1
fitmeasures(outt)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.03,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE)
reg.out2_WM
library(regsem)
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-4,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv",alpha=1,max.iter=200)
fit1
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.03,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE)
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE)
reg.out2_WM
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE)
reg.out2_WM
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE)
reg.out2_WM
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE)
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=20,jump=.01,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE)
plot(reg.out2_WM,c(3:50))
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=20,jump=.01,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE,momentum=TRUE)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=7,jump=.01,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE,momentum=TRUE)
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=20,jump=.01,tol=1e-5,type="enet",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE,momentum=TRUE)
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=20,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE,momentum=TRUE)
library(regsem)
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=20,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.01,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
plot(reg.out2_WM,c(3:50))
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=20,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
library(regsem)
library(regsem)
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),tol=1e-4,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv",alpha=1,max.iter=200)
plot(fit1)
fit1
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="numDeriv")
library(regsem)
library(snowfall)
N = 50
reps = 200
model <-
' # direct effect
Y ~ c*X
# mediator
M1 ~ a1*X
M2 ~ a2*X
M3 ~ a3*X
M4 ~ a4*X
M5 ~ a5*X
Y ~ b1*M1 + b2*M2 + b3*M3 + b4*M4 + b5*M5
# indirect effect (a*b)
a1b1 := a1*b1
a2b2 := a2*b2
a3b3 := a3*b3
a4b4 := a4*b4
a5b5 := a5*b5
# total effect
total := c + (a1*b1) + (a2*b2) + (a3*b3) + (a4*b4) + (a5*b5)
'
fit.delta = fit.cv.delta =  fit.reg =  Data = vector("list", reps)
i=1
X <- rnorm(N)
M1 <- .59*X + rnorm(N)
M2 <- .36*X + rnorm(N)
M3 <- .11*X + rnorm(N)
M4 <- rnorm(N)
M5 <- rnorm(N)
Y <- .59*M1 + .36*M2 + .11*M3 + rnorm(N)
Data[[i]] <- data.frame(X=X, Y=Y, M1=M1, M2=M2, M3=M3, M4=M4, M5=M5)
fit.delta[[i]] = sem(model,data=Data[[i]],meanstructure=FALSE,fixed.x=T)
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=FALSE,step=.01,gradFun="ram",hessFun="numDeriv")
fit.cv.delta[[i]] = cv_regsem(fit.delta[[i]],type="lasso",pars_pen = c(2:11),jump=0.05,multi.iter=20,mult.start=FALSE,
n.lambda=7,tol=1e-4,fit.ret=c("BIC","rmsea","srmr"),
fit.ret2="train",parallel=FALSE,solver=TRUE,step=.01,gradFun="ram",hessFun="numDeriv")
fit.cv.delta[[1]]
plot(fit.cv.delta[[1]])
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=20,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=7,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=7,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=7,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="norm")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=7,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
traceback()
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
reg.out2_WM
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="norm")
reg.out2_WM
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-6,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-8,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
reg.out2_WM
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="none")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="norm")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=10,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
plot(reg.out2_WM,c(3:50))
fits = reg.out2_WM[[2]]
which(fits[,"BIC"]==min(fits[,"BIC"]))
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=30,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
traceback()
library(regsem)
