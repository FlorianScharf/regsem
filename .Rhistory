fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
library(regsem)
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=2,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=4,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),multi.iter=3,max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,step=.1,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
library(regsem)
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=4,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=FALSE,solver=FALSE,hessFun="none")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=1,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=FALSE,solver=FALSE,hessFun="none")
reg.out2_WM
library(lavaan)
HS <- data.frame(scale(HolzingerSwineford1939[,7:15]))
mod <- '
f =~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9
'
#' # Recommended to specify meanstructure in lavaan
outt = cfa(mod,HS,meanstructure=FALSE)
#'
fit1 <- cv_regsem(outt,jump=0.01,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8))
summary(fit1)
fit1 <- cv_regsem(outt,jump=0.01,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
summary(fit1)
fit1
plot(fit1)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
plot(fit1)
summary(outt)
?uniroot
library(regsem)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
library(regsem)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
library(regsem)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
library(regsem)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
library(regsem)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
library(regsem)
library(regsem)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
library(regsem)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
plot(fit1)
library(regsem)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
fit1
plot(fit1)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=1,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=FALSE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=FALSE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
library(regsem)
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=FALSE,solver=TRUE,hessFun="numDeriv")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=FALSE,solver=TRUE,hessFun="numDeriv")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=FALSE,solver=TRUE,hessFun="numDeriv")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=FALSE,solver=TRUE,hessFun="numDeriv")
library(regsem)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
library(regsem)
library(regsem)
fit1 <- cv_regsem(outt,jump=0.05,n.lambda=20,solver=TRUE,type="lasso",pars_pen=c(1:2,6:8),hessFun="numDeriv")
fit1
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=FALSE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=4,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=FALSE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
library(regsem)
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE)
mod <- '
f =~ 1*x1 + 1*x2 + 1*x3 + 0.2*x4 + 0.2*x5 + 0*x6 + 0*x7 +0*x8 + 0*x9
'
dat <- simulateData(mod,model.type="cfa")
mod2 <- 'f =~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9'
outt = cfa(mod2,dat,meanstructure=FALSE)
lavaan(parTable(outt),hs.train)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE)
fit1
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv")
fit1
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-7,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv")
fit1
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv")
fit1
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
library(regsem)
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none")
fit1
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=10,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
plot(fit1)
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
plot(fit1)
fit1
setwd("C:/Users/RJacobucci/Documents/GitHub/mimic_regsem")
setwd("C:/Users/Ross/Documents/GitHub/mimic_regsem")
setwd("C:/Users/jacobucc/Documents/GitHub/mimic_regsem")
library(lavaan)
library(qgraph)
library(semPlot)
library(psych)
library(regsem)
library(lmtest)
library(ggplot2)
library(reshape2)
library(semTools)
#Here one reads in the data - As I can't share it yet I created a dummy dataset with same means and covs.
#Parameter estimates are identical down to the third decimal so for now we can just use the dummy data (for final paper just rerun with the 'real' - only difference would be skewness and nonlinearities but those are negligible)
#datacamcan<-read.csv('CamCAN_cogneuro_data_Ross2017-03-16.csv')  #Reads in real data
datacamcan<-read.csv('schmamcandat2017-03-16.csv')
colnames(datacamcan)[3:50]<-print(paste('gm',1:48,sep=''))        #Unify grey matter labels for easier syntax
colnames(datacamcan)[51:98]<-print(paste('fa',1:48,sep=''))       #Unify grey matter labels for easier syntax
datacamcan$simpred1<-datacamcan$VSTMcolour_K_ss3+rnorm(708,.5,.5) #add dummy predictors for reference
datacamcan$simpred2<-datacamcan$VSTMcolour_K_ss3+rnorm(708,.5,.5) #add dummy predictors for reference
#Below the syntax to fit normal ML and regsem MIMIC models to predict a single LV (vstmlv) measured by three observables
#Syntax below is to use white matter (fa) and grey matter (gm) to predict a single LV.
#Total R^2 for FA predicting vstmlv is ~38% (versus 8% with noise), and ~27% for gm
#Most exciting would be to include both of course
#############Predicting VSTM: White matter (48 ROIS)
vstmCFA_WM<-'
vstmlv=~VSTMcolour_K_ss2+VSTMcolour_K_ss3+VSTMcolour_K_ss4
vstmlv~fa 1 +fa 2 +fa 3 +fa 4 +fa 5 +fa 6 +fa 7 +fa 8 +fa 9 +fa 10 +fa 11 +fa 12 +fa 13 +fa 14 +fa 15 +fa 16 +fa 17 +fa 18 +fa 19 +fa 20 +fa 21 +fa 22 +fa 23 +fa 24 +fa 25 +fa 26 +fa 27 +fa 28 +fa 29 +fa 30 +fa 31 +fa 32 +fa 33 +fa 34 +fa 35 +fa 36 +fa 37 +fa 38 +fa 39 +fa 40 +fa 41 +fa 42 +fa 43 +fa 44 +fa 45 +fa 46 +fa 47 +fa 48
'
fitvstm_WM <- cfa(vstmCFA_WM, data=datacamcan, estimator='mlr',missing='fiml')
summary(fitvstm_WM, fit.measures=TRUE, standardized=TRUE, rsquare=TRUE)
#regsem
lav.out_WM<-try(lavaan::sem(vstmCFA_WM,datacamcan,fixed.x=TRUE,meanstructure=FALSE),silent=TRUE)
A <- extractMatrices(lav.out_WM)$A
A[A!=0]
#cov.test= cov(data.test[,c(51:98,100:102)],use="complete.obs")
#tt = regsem(lav.out_WM)
#reg.out1_WM <- cv_regsem(lav.out_WM,n.lambda=40,jump=0.005,solver=TRUE,tol=1e-4,type="enet",pars_pen=c(3:50),
#                         fit.ret=c("rmsea","BIC","srmr","EBIC.25","EBIC.5","AIC","CAIC"))
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=3,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=3,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="none")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=3,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=3,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="none")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=3,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
wisc <- read.table("/Users/Ross/Documents/Github/random_code/wisc4vpe.dat")
wisc <- read.table("C:/Users/RJacobucci/Documents/GitHub/EDM_Labs/2015/wisc4vpe.dat")
wisc <- read.table("C:/Users/jacobucc/Documents/GitHub/EDM_Labs/2015/wisc4vpe.dat")
names(wisc)<- c("V1","V2","V4","V6","P1","P2","P4", "P6", "Moeducat")
library(regsem)
lds_1 <- "
#latent variables
lV1 =~ 1*V1
lV2 =~ 1*V2
lV4 =~ 1*V4
lV6 =~ 1*V6
#autoregressions
lV2 ~ 1*lV1; lV4 ~ 1*lV2; lV6 ~ 1*lV4
#change - delta; d
dV1 =~ 1*lV2; dV2 =~ 1*lV4; dV3 =~ 1*lV6
#intercept and slope
inV =~ 1*lV1;
#slope =~ alpha*dV1 + alpha*dV2 + alpha*dV3
# match lgm
slope =~ 1*dV1 + 2*dV2 + 2*dV3
#slope =~ 1.17*dV1 + alpha1*dV2 + alpha2*dV3
#manifest means @0
V1 ~ 0*1; V2 ~0*1; V4 ~ 0*1; V6 ~ 0*1
#slope and intercept means
slope ~ 1;
inV ~ 1;
#Latent variances and covariance
slope ~~ slope;
inV ~~ inV;
slope ~~ inV;
#means and vars @0
lV1 ~ 0*1; lV2 ~0*1; lV4 ~ 0*1; lV6 ~ 0*1
dV1 ~ 0*1; dV2 ~0*1; dV3 ~ 0*1
lV1 ~~ 0*lV1; lV2 ~~ 0*lV2; lV4 ~~ 0*lV4; lV6 ~~ 0*lV6
dV1 ~~ 0*dV1; dV2 ~~ 0*dV2; dV3 ~~ 0*dV3
#auVo-proportions
dV1 ~ beta*lV1; dV2 ~ beta*lV2; dV3 ~ beta*lV4;
#residuals equal
V1 ~~ resid*V1; V2 ~~ resid*V2; V4 ~~ resid*V4; V6 ~~ resid*V6;
"
fit.lds <- lavaan(lds_1, data=wisc)
summary(fit.lds,standardized=TRUE,fit=TRUE)
# problem with mult.start=TRUE
#################################### check out gradient ###########################33333
#mats = extractMatrices(fit.lds)
#model = fit.lds
#mm = extractMatrices(model)$A[,"1"]
#SampMean <- model@SampleStats@mean[][[1]]
#ss = match(names(mm[mm > 0]),model@Data@ov$name)
#SampMean[-c(ss)] = 0
#SampCov <- model@SampleStats@cov[][[1]]
#SampCov2 <- SampCov + SampMean%*%t(SampMean)
# try changing size of SampCov
#SampCov3 = cbind(SampCov2,SampMean)
#SampCov = rbind(SampCov3,append(SampMean,1))
#ImpCov = RAMmult(mats$parameters,mats$A,mats$S,mats$F,mats$A_fixed,mats$A_est,mats$S_fixed,mats$S_est)
#round(rcpp_grad_ram(mats$parameters, ImpCov$ImpCov, SampCov, mats$A_est, mats$S_est,
#              mats$A, mats$S, mats$F, lambda=0, type2=0, pen_vec=0, diff_par=0),3)
#m3 = fitted(fit.lds)$mean
#cov3 = fitted(fit.lds)$cov
#cov3 + m3 %*% t(m3)
#inspect(fit.lds,what="gradient")
######################################################################################
#starts <- c(1,19.8,.2,1.5,19.4,3,12.8)
out <- regsem(fit.lds,solver=TRUE,hessFun="numDeriv",gradFun="ram",tol=1e-5,type="lasso",lambda=.1,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="numDeriv",gradFun="ram",tol=1e-5,type="lasso",lambda=.05,pars_pen=3)
out <- regsem(fit.lds,solver=FALSE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=.05,pars_pen=3)
summary(out)
summary(fit.lds,standardized=TRUE,fit=TRUE)
out <- regsem(fit.lds,solver=FALSE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=0,pars_pen=3)
warnings()
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
fit1
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
fit1
plot(fit1)
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
fit1
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv"))
fit1
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
fit1
out <- regsem(fit.lds,solver=TRUE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=0,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=0.01,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="numDeriv",gradFun="ram",tol=1e-5,type="lasso",lambda=0.01,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="numDeriv",gradFun="ram",tol=1e-5,type="lasso",lambda=0.1,pars_pen=3)
out <- regsem(fit.lds,solver=TRUE,hessFun="numDeriv",gradFun="ram",tol=1e-5,type="lasso",lambda=0.05,pars_pen=3)
out <- regsem(fit.lds,solver=TRUE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=0.05,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=0.08,pars_pen=3)
out <- regsem(fit.lds,solver=FALSE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=0.08,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=0.08,pars_pen=3)
library(regsem)
out <- regsem(fit.lds,solver=TRUE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=0.08,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=0.03,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="numDeriv",gradFun="ram",tol=1e-5,type="lasso",lambda=0.03,pars_pen=3)
summary(out)
library(regsem)
out <- regsem(fit.lds,solver=TRUE,hessFun="numDeriv",gradFun="ram",tol=1e-5,type="lasso",lambda=0.03,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="numDeriv",gradFun="ram",tol=1e-5,type="lasso",lambda=0.07,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="none",gradFun="ram",tol=1e-5,type="lasso",lambda=0.07,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="numDeriv",gradFun="ram",tol=1e-5,type="lasso",lambda=0.07,pars_pen=3)
summary(out)
out <- regsem(fit.lds,solver=TRUE,hessFun="numDeriv",gradFun="ram",tol=1e-5,type="lasso",lambda=0.1,pars_pen=3)
summary(out)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=3,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=3,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="norm")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="norm")
plot(reg.out2_WM,c(3:50))
reg.out2_WM
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="norm")
reg.out2_WM
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.02,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
plot(fit1)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
fit1
plot(fit1)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=FALSE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
fit1
plot(fit1)
library(regsem)
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="none"))
fit1
plot(fit1)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="norm")
system.time(fit1 <- cv_regsem(outt,n.lambda=30,jump=0.01,type="lasso",fit.ret=c("chisq","ncp","rmsea","BIC"),n.boot=20,tol=1e-6,
pars_pen=c(3:8),solver=TRUE,fit.ret2="train",mult.start=TRUE,hessFun="numDeriv"))
fit1
plot(fit1)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="norm")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="norm")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="none")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="none")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="ram")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=5,jump=.1,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=FALSE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=30,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=21,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=13,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=13,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="none")
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=13,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=FALSE,hessFun="none")
reg.out2_WM
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=13,jump=.01,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
reg.out2_WM
plot(reg.out2_WM,c(3:50))
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=13,jump=.04,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
library(regsem)
reg.out2_WM <- cv_regsem(lav.out_WM,n.lambda=13,jump=.04,tol=1e-5,type="lasso",pars_pen=c(3:50),max.iter=200,multi.iter=3,
fit.ret=c("chisq","ncp","BIC","rmsea"),fit.ret2="train",mult.start=TRUE,solver=TRUE,hessFun="numDeriv")
library(regsem)
nobs=100
iv <- rbinom(nobs,1,0.5)
med1 <- 0.8*iv + rnorm(nobs)
med2 <- 0.2*iv + rnorm(nobs)
med3 <- 0*iv + rnorm(nobs)
med1 <- as.numeric(scale(med1));med2 <- as.numeric(scale(med2));med3 <- as.numeric(scale(med3))
h1 <- 1*med1 + rnorm(nobs);h2 <- 1*med1 + rnorm(nobs);h3 <- 1*med1 + rnorm(nobs);
g1 <- 1*med2 + rnorm(nobs);g2 <- 1*med2 + rnorm(nobs);g3 <- 1*med2 + rnorm(nobs);
k1 <- 1*med3 + rnorm(nobs);k2 <- 1*med3 + rnorm(nobs);k3 <- 1*med3 + rnorm(nobs);
dv <- 0.8*med1 + 0.2*med2 + 0*med3 + 0.5*iv + rnorm(nobs)
dat <- cbind(iv,h1,h2,h3,g1,g2,g3,k1,k2,k3,med1,med2,med3,dv)
#dat[,2:14] <- scale(dat[,2:14])
lav.mod <-"
med1 =~ h1 + h2 + h3
med2 =~ g1 + g2 + g3
med3 =~ k1 + k2 + k3
#med1~~1*med1;med2~~1*med2;med3~~1*med3
med1 ~ iv
med2 ~ iv
med3 ~ iv
dv ~ med1 + med2 + med3 + iv
"
lav.out <- sem(lav.mod,dat)
summary(lav.out)
extractMatrices(lav.out)["A"]
system.time(cv.out <- cv_regsem(lav.out,type="enet",pars_pen=c(7:9,10:12),optMethod="coord_desc",
solver=TRUE,gradFun="ram",quasi=TRUE,hessFun="none",n.lambda=25,jump=0.02,step=1))
plot(cv.out)
system.time(cv.out2 <- cv_regsem(lav.out,type="enet",pars_pen=c(7:9,10:12),optMethod="coord_desc",
solver=FALSE,gradFun="ram",quasi=FALSE,hessFun="none",n.lambda=25,jump=1,step=.1))
plot(cv.out2)
system.time(cv.out3 <- cv_regsem(lav.out,type="enet",pars_pen=c(7:9,10:12),optMethod="coord_desc",
solver=FALSE,gradFun="ram",quasi=TRUE,hessFun="none",n.lambda=25,jump=1,step=.1))
cv.out3
system.time(cv.out3 <- cv_regsem(lav.out,type="enet",pars_pen=c(7:9,10:12),optMethod="coord_desc",
solver=FALSE,gradFun="ram",quasi=TRUE,hessFun="none",n.lambda=25,jump=,1,step=.1))
cv.out3
system.time(cv.out3 <- cv_regsem(lav.out,type="enet",pars_pen=c(7:9,10:12),optMethod="coord_desc",
solver=FALSE,gradFun="ram",quasi=TRUE,hessFun="none",n.lambda=25,jump=.1,step=.1))
cv.out3
plot(cv.out3)
system.time(cv.out3 <- cv_regsem(lav.out,type="enet",pars_pen=c(7:9,10:12),optMethod="coord_desc",
solver=FALSE,gradFun="ram",quasi=TRUE,hessFun="none",n.lambda=25,jump=.4,step=.1))
cv.out3
plot(cv.out3)
system.time(cv.out3 <- cv_regsem(lav.out,type="enet",pars_pen=c(7:9,10:12),optMethod="coord_desc",
solver=FALSE,gradFun="ram",quasi=TRUE,hessFun="norm",n.lambda=25,jump=.4,step=.1))
plot(cv.out3)
system.time(cv.out3 <- cv_regsem(lav.out,type="enet",pars_pen=c(7:9,10:12),optMethod="coord_desc",
solver=FALSE,gradFun="ram",quasi=TRUE,hessFun="norm",n.lambda=25,jump=.2,step=.1))
cv.out3
plot(cv.out3)
system.time(cv.out3 <- cv_regsem(lav.out,type="enet",pars_pen=c(7:9,10:12),optMethod="coord_desc",
solver=FALSE,gradFun="ram",quasi=TRUE,hessFun="numDeriv",n.lambda=25,jump=.2,step=.1))
plot(cv.out3)
plot(cv.out)
plot(cv.out2)
